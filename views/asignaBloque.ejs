<!DOCTYPE html>
<html lang="en">

<head>

    
    
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Gas Unión Administrador</title>

    <!-- Fontfaces CSS-->
    <link href="/css/font-face.css" rel="stylesheet" media="all">
    <link href="/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="/vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="/vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="/vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="/vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="/vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="/vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    



    <!-- Main CSS-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.min.css">
    <link href="/css/theme.css" rel="stylesheet" media="all">

    <style>
        .adminPENDIENTE {
            background-color: white;
            
        }
        
        .adminASIGNADO {
            background-color: rgb(116, 176, 250);
        
        }
        .adminCOMPLETADO {
            background-color: rgb(32, 167, 32);
            
        }
        .adminCANCELADO {
            background-color: red;
            
        }
        .adminREAGENDADO {
            background-color:yellow;
            
        }
        .adminPARCIAL{
            background-color: rgb(235, 134, 235);
        }
        .titulo{
            background-color: gray;
        }
        
    </style>
</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER DESKTOP-->
        <header class="header-desktop3 d-none d-lg-block">
            <div class="section__content section__content--p35">
                <div class="header3-wrap">
                    <div class="header__logo">
                        <a href="/administracion"> 
                            <img src="images/icon/Logo1.png" alt="GasUnion" style="height: 50px;" />
                            
                        </a>
                    </div>
                    
                    <div class="header__tool">
                        
                        
                        <div class="account-wrap">
                            <div class="account-item account-item--style2 clearfix js-item-menu">
                                <div class="image">
                                    <a href="#">
                                        <img src="images/icon/usuario.png" alt="John Doe" />
                                    </a>
                                </div>
                                <div class="content">
                                    <a class="js-acc-btn" href="#"><%= datos.nombre %></a>
                                </div>
                                <div class="account-dropdown js-dropdown">
                                    <div class="info clearfix">
                                        <div class="image">
                                            <a href="#">
                                                <img src="images/icon/usuario.png" alt="John Doe" />
                                            </a>
                                        </div>
                                        <div class="content">
                                            <h5 class="name">
                                                <a href="#"><%= datos.nombre %></a>
                                            </h5>
                                            <span class="email"><%= datos.rol %></span>
                                        </div>
                                    </div>
                                    
                                    <div class="account-dropdown__footer">
                                        <a href="/logout">
                                            <i class="zmdi zmdi-power"></i>Cerrar Sesión</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- END HEADER DESKTOP-->

        <!-- HEADER MOBILE-->
        <header class="header-mobile header-mobile-2 d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="/administracion">
                            <img src="images/icon/Logo1.png" alt="GasUnion" style="height: 50px;" />
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    
                </div>
            </nav>
        </header>
        <div class="sub-header-mobile-2 d-block d-lg-none">
            <div class="header__tool">
                
                <div class="account-wrap">
                    <div class="account-item account-item--style2 clearfix js-item-menu">
                        <div class="image">
                            <img src="images/icon/usuario.png" alt="John Doe" />
                        </div>
                        <div class="content">
                            <a class="js-acc-btn" href="#"><%= datos.nombre %></a>
                        </div>
                        <div class="account-dropdown js-dropdown">
                            <div class="info clearfix">
                                <div class="image">
                                    <a href="#">
                                        <img src="images/icon/usuario.png" alt="John Doe" />
                                    </a>
                                </div>
                                <div class="content">
                                    <h5 class="name">
                                        <a href="#"><%= datos.nombre %></a>
                                    </h5>
                                    <span class="email"><%= datos.rol %></span>
                                </div>
                            </div>
                            
                            <div class="account-dropdown__footer">
                                <a href="/logout">
                                    <i class="zmdi zmdi-power"></i>Cerrar Sesión</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END HEADER MOBILE -->

        <!-- PAGE CONTENT-->
        <div class="page-content--bgf7">
            

            

            

            <!-- DATA TABLE -->
            <section class="p-t-20">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <h3 class="title-5 m-b-35"></h3>
                            <div class="form-group">
                                <input type="text" class="form-control pull-right" style="width:20%" id="search" placeholder="Buscar...">
                            </div>
                            <div class="table-responsive table-responsive-data2">
                                <table style=" border: 1px solid black;" class="table table-data2" id="administracion">
                                    <h3 class="title-5 m-b-35">Administración</h3>
                                    <thead>
                                        <tr class="titulo">
                                            
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Números de Clientes</th>
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Municipio</th>
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="spacer"></tr>
                                        <tr class="tr-shadow">
                                            <% results3.forEach((adminService)=>{ %>
                                                <tr class="<%= 'admin' + adminService.statusServicio %>"> 
                                                    <td style="font-size: 14px;border: 1px solid #333; color: black;"><%= adminService.numerosClientes %></td>  
                                                    <td style="font-size: 14px;border: 1px solid #333; color: black;"><%= adminService.municipio %></td>
                                                   
                                                    
                                                    
                                                    
                                                    <td style="font-size: 12px; border: 1px solid #333; color: white;">
                                                        <div class="table-data-feature">
                                                            
                                                            <select class="custom-select" id="selectedAdminRoute_<%= adminService.numerosClientes %>">
                                                                <option value="" disabled selected>Selecciona una opción</option>
                                                                <% unidades.forEach((noEco) => { %>
                                                                    <option><%=  noEco %></option>
                                                                  <% }); %>
                                                            </select>
                                                            <button class="item btn-asignar" data-cliente-id="<%= adminService.numerosClientes %>" data-toggle="tooltip" data-placement="top" title="Aprobar">
                                                                <i class="zmdi zmdi-check"></i>
                                                            </button>
                                                            
                                                        </div>
                                                    </td>
                                                    
                                                </tr>                                   
                                             <% }) %>
                                        </tr>
                                    </tbody>
                                </table>

                                <table style=" border: 1px solid black;" class="table table-data2" id="administracion">
                                    <h3 class="title-5 m-b-35">Suministros</h3>
                                    <thead>
                                        <tr class="titulo">
                                            
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Números de Clientes</th>
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Municipio</th>
                                            <th style="font-size: 16px;border: 1px solid #333; color:white;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="spacer"></tr>
                                        <tr class="tr-shadow">
                                            <% results.forEach((adminService)=>{ %>
                                                <tr class="<%= 'admin' + adminService.statusServicio %>"> 
                                                    <td style="font-size: 14px;border: 1px solid #333; color: black;"><%= adminService.numerosClientes %></td>  
                                                    <td style="font-size: 14px;border: 1px solid #333; color: black;"><%= adminService.municipio %></td>
                                                    
                                                    
                                                    
                                                    
                                                    <td style="font-size: 12px; border: 1px solid #333; color: white;">
                                                        <div class="table-data-feature">
                                                            <select class="custom-select" id="selectedAdminRoutesum_<%= adminService.numerosClientes %>">
                                                                <option value="" disabled selected>Selecciona una opción</option>
                                                                <% unidades.forEach((noEco) => { %>
                                                                    <option><%=  noEco %></option>
                                                                  <% }); %>
                                                            </select>
                                                            <button class="item btn-asignar-sum" data-cliente-id="<%= adminService.numerosClientes %>" data-toggle="tooltip" data-placement="top" title="Aprobar">
                                                                <i class="zmdi zmdi-check"></i>
                                                            </button>
                                                            
                                                            
                                                        </div>
                                                    </td>
                                                    
                                                </tr>                                   
                                             <% }) %>
                                        </tr>
                                    </tbody>
                                </table>

                                
                                
                                
                                
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- END DATA TABLE-->
            

           
        </div>

    </div>

    <script>

        

        

        $(document).ready(function() {
            // Inicializar el datepicker para cada campo de fecha
            $(".datepicker").datepicker({
                format: 'yyyy-mm-dd', // Formato de fecha deseado
                autoclose: true
            });
        });

        

        
        

    </script>

    <script>
        // Asegúrate de ejecutar este código después de que se cargue el DOM
        document.addEventListener("DOMContentLoaded", function () {
            // Selecciona todos los botones con la clase btn-asignar
            const btnAsignarArray = document.querySelectorAll('.btn-asignar');
    
            // Agrega un controlador de clic a cada botón
            btnAsignarArray.forEach(btn => {
                btn.addEventListener('click', function () {
                    // Obtiene el ID del cliente desde el atributo data
                    const clienteId = this.dataset.clienteId;
    
                    // Obtiene el valor seleccionado del select
                    const unidadSeleccionada = document.getElementById(`selectedAdminRoute_${clienteId}`).value;

                    const clienteIds = clienteId.split(',').map(Number);
    
                    // Realiza la solicitud AJAX
                    fetch('/asignar-unidad-admin', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            clienteIds: clienteIds,
                            unidad: unidadSeleccionada
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('ACTUALIZADA')
                        console.log(data);
                        // Puedes realizar acciones adicionales después de la actualización
                        window.location.reload();
                    })
                    .catch(error => {
                        console.error('Error al enviar solicitud AJAX:', error);
                    });
                });
            });
        });
    </script>

    <script>
        // Asegúrate de ejecutar este código después de que se cargue el DOM
        document.addEventListener("DOMContentLoaded", function () {
            // Selecciona todos los botones con la clase btn-asignar
            const btnAsignarArray = document.querySelectorAll('.btn-asignar-sum');
    
            // Agrega un controlador de clic a cada botón
            btnAsignarArray.forEach(btn => {
                btn.addEventListener('click', function () {
                    // Obtiene el ID del cliente desde el atributo data
                    const clienteId = this.dataset.clienteId;
    
                    // Obtiene el valor seleccionado del select
                    const unidadSeleccionada = document.getElementById(`selectedAdminRoutesum_${clienteId}`).value;

                    const clienteIds = clienteId.split(',').map(Number);
    
                    // Realiza la solicitud AJAX
                    fetch('/asignar-unidad-sum', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            clienteIds: clienteIds,
                            unidad: unidadSeleccionada
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('ACTUALIZADA')
                        console.log(data);
                        // Puedes realizar acciones adicionales después de la actualización
                        window.location.reload();
                    })
                    .catch(error => {
                        console.error('Error al enviar solicitud AJAX:', error);
                    });
                });
            });
        });
    </script>
    
    

    <!-- Jquery JS-->
    <script src="/vendor/jquery-3.2.1.min.js"></script>
    
    <!-- Bootstrap JS-->
    <script src="/vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="/vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="/vendor/slick/slick.min.js">
    </script>
    <script src="/vendor/wow/wow.min.js"></script>
    <script src="/vendor/animsition/animsition.min.js"></script>
    <script src="/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>
    <script src="/vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="/vendor/counter-up/jquery.counterup.min.js">
    </script>
    <script src="/vendor/circle-progress/circle-progress.min.js"></script>
    <script src="/vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="/vendor/select2/select2.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.min.js"></script>


    <!-- Main JS-->
    <script src="/js/main.js"></script>

    <!-- Main JS-->
    <script>
        function confirmar(id){
            Swal.fire({
              title: 'Confirma eliminar el registro: '+id+' ?',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Confirmar',
            }).then((result) => {
              
              if (result.isConfirmed) {
                window.location = '/deleteClientAdministracion/'+id;
              } 
            })
          }
    
        $(document).ready(function(){
            $("#search").keyup(function(){
                _this = this;
                const searchValue = $(_this).val().toLowerCase();
    
                $.each($("#administracion tbody tr"), function() {
                    const clienteColumn = $(this).find("td:nth-child(1)").text().toLowerCase();
                    const nombreColumn = $(this).find("td:nth-child(2)").text().toLowerCase();
                    const direccionColumn = $(this).find("td:nth-child(3)").text().toLowerCase();
    
                    if (clienteColumn.indexOf(searchValue) === -1 &&
                        nombreColumn.indexOf(searchValue) === -1 &&
                        direccionColumn.indexOf(searchValue) === -1) {
                        $(this).hide();
                    } else {
                        $(this).show();
                    }
                });
            });
        });
    </script>

</body>

</html>
<!-- end document-->
